<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="以全栈工程师为目标，奋斗努力"><title>js闭包概念 | NewGeneral's Blog</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.3.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.3.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">js闭包概念</h1><a id="logo" href="/.">NewGeneral's Blog</a><p class="description">“求知若饥，虚心若愚”</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">js闭包概念</h1><div class="post-meta">Mar 14, 2017<span> | </span><span class="category"><a href="/categories/javascript/">javascript</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/03/14/js闭包概念/" href="/2017/03/14/js闭包概念/#comments" class="ds-thread-count"></a><div class="post-content"><h1 id="js闭包概念介绍"><a href="#js闭包概念介绍" class="headerlink" title="js闭包概念介绍"></a>js闭包概念介绍</h1><p>写这份博客的原因是在某个充满活力的早晨被某人的画法<a href="https://github.com/houyhea/blog/blob/master/20150524.md" target="_blank" rel="external">houyhea</a>所吸引，学习了一下之前不是很懂的闭包概念。</p>
<p>本篇博客以引文为主，请大家记得给原作者点赞</p>
<a id="more"></a>
<p>根据《JavaScript权威指南》里对于闭包的解释</p>
<blockquote>
<p>所有的JavaScript函数都是闭包，而当一个嵌套函数被导出到定义它的作用域外时，会发生很有趣（蛋疼）的事情</p>
</blockquote>
<p>阮一峰的理解</p>
<blockquote>
<p>闭包可以简单理解为定义在一个函数内部的函数，然后可以通过返回这个函数访问到定义它的函数的局部变量。闭包就是能够读取其他函数内部变量的函数。</p>
</blockquote>
<p>比如说</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　<span class="keyword">var</span> n=<span class="number">999</span>;</div><div class="line">　　　　<span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　　　alert(n); </div><div class="line">　　　　&#125;</div><div class="line">　　　　<span class="keyword">return</span> f2;</div><div class="line">　　&#125;</div><div class="line">　　<span class="keyword">var</span> result=f1();</div><div class="line">　　result(); <span class="comment">// 999</span></div></pre></td></tr></table></figure>
<p>这个例子里面f2就是一个闭包，因为f2在f1中定义，并且可以读取f1的局部变量。</p>
<p>闭包除了能够读取函数的内部变量外，还能够让这些变量驻留在内存中。例如以下这个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　<span class="keyword">var</span> n=<span class="number">999</span>;</div><div class="line">　　　　nAdd=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;n+=<span class="number">1</span>&#125;</div><div class="line">　　　　<span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　　　alert(n);</div><div class="line">　　　　&#125;</div><div class="line">　　　　<span class="keyword">return</span> f2;</div><div class="line">　　&#125;</div><div class="line">　　<span class="keyword">var</span> result=f1();</div><div class="line">　　result(); <span class="comment">// 999</span></div><div class="line">　　nAdd();</div><div class="line">　　result(); <span class="comment">// 1000</span></div></pre></td></tr></table></figure>
<p>可见函数f1的局部变量n在f1调用结束之后并没有被清除。因为f2依赖于f1，而f2被赋给了一个全局变量result，所以f2不会被销毁，于是f1也不能被销毁，于是n也就留下来了。这个例子中的nAdd是一个全局变量，因为没有加上var，原因可参见阮一峰的博客，在参考文献中给出。</p>
<p>这里，我有一个疑问，<strong>如果闭包被赋予的是一个局部变量，那么还会发生内存驻留的问题吗？</strong>还是说这种情况本身就不存在。请大神指点。</p>
<p>最后放上一张用尽目前绘画能力的闭包示意图，请各位指点</p>
<p><img src="../imgs/package.gif" alt="package"></p>
<p>外面的框子可以理解成一个函数，a是这个函数中的局部变量。正常情况下是不能从函数外部访问a的，所以需要一个钩子将a勾出来。这个钩子的底就是fn，也就是声明在同一个函数内部的函数，代码示例如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　<span class="keyword">var</span> a=<span class="number">999</span>;</div><div class="line">　　　　<span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">　　　　　　alert(n); </div><div class="line">　　　　&#125;</div><div class="line">　　　　<span class="keyword">return</span> fn;</div><div class="line">　　&#125;</div></pre></td></tr></table></figure>
<p>通过return fn将闭包传递出去，然后外部就可以通过这个返回值，访问内部的变量，就像拿住了钩子的柄，勾出了东西。</p>
<p><strong>闭包虽好，但是不要乱用，js的gc目前还伤不起</strong></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol>
<li><a href="https://github.com/houyhea/blog/blob/master/20150524.md" target="_blank" rel="external">一张图搞定闭包概念</a></li>
<li><a href="http://www.oreilly.com.cn/index.php?func=book&amp;isbn=978-7-111-21632-2" target="_blank" rel="external">javascript权威指南</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="external">阮一峰:学习Javascript闭包（Closure）</a></li>
</ol>
</div><div class="tags"><a href="/tags/package/">package</a></div><div class="post-nav"><a href="/2017/03/10/130. Surrounded Regions/" class="next">LeetCode 130. Surrounded Regions</a></div><div data-thread-key="2017/03/14/js闭包概念/" data-title="js闭包概念" data-url="http://yoursite.com/2017/03/14/js闭包概念/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到:</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div id="comments"><div data-thread-key="2017/03/14/js闭包概念/" data-title="js闭包概念" data-url="http://yoursite.com/2017/03/14/js闭包概念/" data-author-key="1" class="ds-thread"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/BookNote/">BookNote</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Picture-Tech/">Picture Tech</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/frontend/" style="font-size: 15px;">frontend</a> <a href="/tags/LeetCode/" style="font-size: 15px;">LeetCode</a> <a href="/tags/package/" style="font-size: 15px;">package</a> <a href="/tags/fullstack/" style="font-size: 15px;">fullstack</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/03/14/js闭包概念/">js闭包概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/10/130. Surrounded Regions/">LeetCode 130. Surrounded Regions</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/04/WebP 结论介绍/">WebP简单介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/01/Web全栈工程师的自我修养读书笔记/">Web全栈工程师的自我修养读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/01/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-commt"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.3.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:yunlongzi@126.com" target="_blank" class="fa fa-email"> </a><a href="null" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/NewNapoleon" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">YunqingChen</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script>var duoshuoQuery = {short_name:'newgeneral'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    document.getElementsByTagName('body')[0].appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.json.js?v=1.3.0"></script></body></html>